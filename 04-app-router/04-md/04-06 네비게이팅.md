# section04-06 네비게이팅

## 네비게이팅

- 페이지 이동을 의미
- App Router에서도 Page Router처럼 CSR 방식으로 네비게이팅 (페이지 이동)을 처리하게 됨
- Server Component가 추가되어 방식이 아주 조금 변경됨

### App Router 네비게이팅 방식

- 초기접속 요청이 일어났을때 서버에서 브라우저한테
  JS번들(클라이언트 컴포넌트 정보) 과 RSC Payload(서버 컴포넌트 정보) 정보를 보냄
- 브라우저는 받은 JS 번들을 실행해 RSC Payload와 합쳐서 페이지를 적절히 교체함

## 프로그래메틱하게 페이지 이동

- useRouter 사용
- **next/navigation**의 **useRouter** 사용
  - 참고로 Page Router는 next/router의 useRouter 사용했었음

## 프리패칭

- 이동할 페이지의 데이터를 미리 불러오는 기능
- Link들이 있어 이동할 가능성이 있는 모든 페이지의 데이터를 미리 불러오는 동작
- bulild 이후 프로덕션 모드로 실행 후 확인가능

<!-- layout.tsx -->

```tsx
import { ReactNode } from "react";
import SearchBar from "../../components/searchbar";
import Link from "next/link";

export default function Layout({ children }: { children: ReactNode }) {
  return (
    <>
      <SearchBar />
      <header>
        <Link href={"/"}>index</Link> {/* → 프리패칭 */}
        &nbsp;
        <Link href={"/search"}>search</Link> {/* → 프리패칭 */}
        &nbsp;
        <Link href={"/book/1"}>book/1</Link> {/* → 프리패칭 */}
      </header>
      {children}
    </>
  );
}
```

### 프로덕션 모드 실행후 프리패칭 결과

- Network 탭에서 search, book/1에 대한 RSC Payload 요청은 확인 가능
  ![alt text](<image/프리패칭 확인.png>)

-반면 index(/) 페이지에 대한 RSC Payload 파일은 존재하지 않음

-이를 통해 RSC Payload는 항상 생성되는 것이 아니라, ‘필요한 경우에만 생성됨’을 확인할 수 있음

-index 페이지는 payload 파일이 생성되지 않음

-index 페이지의 특징
└──서버 컴포넌트로만 구성됨
└──동적 데이터 패칭 없음
└──URL 파라미터 및 쿼리스트링 사용 없음
└──완전히 static한 페이지
└──빌드 타임에 HTML이 이미 확정됨

-따라서 index 페이지는
HTML만으로 화면 구성이 충분하다고 판단되어 RSC Payload 생성 자체가 생략됨

### static / dynamic 페이지 프리패칭 동작 과정

- static : 빌드 타임에 결과가 확정된 페이지로 상황에 따라 프리패칭 시 RSC Payload가 전달될 수 있음
  필요하다고 판단되면 JS 번들까지 함께 프리패칭될 수 있음
  즉, static 페이지는 HTML만으로 충분한 경우에는 프리패칭 요청이 생략될 수도 있음
- dynamic : 요청 시점에 데이터가 달라질 수 있는 페이지로 프리패칭 단계에서는 JS 번들은 제외
  RSC Payload만 프리패칭
  JS 번들은 실제 페이지 이동이 발생했을 때 로드됨 ≒ JS 번들은 기본적으로 프리패칭 대상이 아님

## 정리

- 프리패칭 전략은 static / dynamic 구분뿐만 아니라
  페이지 특성, 캐시 상태, 현재 진입 위치 등을 종합해 Next.js가 동적으로 결정한다.
