# section04-06 네비게이팅

## 네비게이팅

- 페이지 이동을 의미
- App Router에서도 Page Router처럼 CSR 방식으로 네비게이팅 (페이지 이동)을 처리하게 됨
- Server Component가 추가되어 방식이 아주 조금 변경됨

### App Router 네비게이팅 방식

- 초기접속 요청이 일어났을때 서버에서 브라우저한테
  JS번들(클라이언트 컴포넌트 정보) 과 RSC Payload(서버 컴포넌트 정보) 정보를 보냄
- 브라우저는 받은 JS 번들을 실행해 RSC Payload와 합쳐서 페이지를 적절히 교체함

## 프로그래메틱하게 페이지 이동

- useRouter 사용
- next/navigation의 useRouter 사용
  - 참고로 Page Router는 next/router의 useRouter 사용했었음

## 프리패칭

- 이동할 페이지의 데이터를 미리 불러오는 기능
- Link들이 있어 이동할 가능성이 있는 모든 페이지의 데이터를 미리 불러오는 동작
- bulild이후 프로덕션 모드로 실행 후 확인가능

### 프로덕션 모드 실행후 프리패칭 결과

<!-- layout.tsx -->

```tsx
import { ReactNode } from "react";
import SearchBar from "../../components/searchbar";
import Link from "next/link";

export default function Layout({ children }: { children: ReactNode }) {
  return (
    <>
      <SearchBar />
      <header>
        <Link href={"/"}>index</Link>
        &nbsp;
        <Link href={"/search"}>search</Link>
        &nbsp;
        <Link href={"/book/1"}>book/1</Link>
      </header>
      {children}
    </>
  );
}
```

- Network탭에서 index, search, book/1 Payload 전달된거 확인가능
- book페이지는 클라이언트 컴포넌트를 포함했는데 JS번들은 안넘어왔음
- 간략하게 맛보기 버전으로 설명하자면,
  이유는 인덱스 페이지 경우에는 스태틱한 페이지,
  즉 정적인 페이지이기 때문에 JS 번들까지 미리 다 불러오게 되지만,
  book/1 페이지의 경우에는 다이나믹 페이지
  즉, 동적인 페이지로써 설정되어 있기때문에 JS번들은 생략하고 RSC 페이로드만 불러오도록 설정된 것임
- 빌드결과를 보면 APP Router에 존재하는 모든 페이지는 기본적으로 static하거나 dynamic한 페이지로 나뉘게 되는데,
- static 페이지는 페이지 라우터 버전의 SSG방식으로 빌드타임에 미리 생성이 된 정적인 페이지를 의미
- dynamic 페이지는 페이지 라우터 버전의 SSR방식으로
  브라우저가 요청을 보낼때마다 즉각적으로 생성하게 되는 동적인 페이지를 의미
- 페이지를 나누는 기준은
  기본적으로 static페이지로 설정이 되고, 만약 페이지 내부에서 쿼리스트링, URL 파라미터를 꺼내서 쓰는 경우 (빌드타임에 생성하면 안될거 같은 동작을 수행하는 경우) 자동으로 동적인 페이지로 설정됨
- 따라서 book/1은 URL 파라미터를 꺼내 써야하기 때문에 기본적으로 dynamic 페이지로 설정됨

### static / dynamic 페이지 프리패칭 동작 과정

- static : 데이터의 업데이트가 추가로 필요하지 않으니 프리패칭으로 RSC Payload와 JS번들을 둘다 불러옴
- dynamic : 데이터의 업데이트가 햐웋에 필요할 수 있기 때문에 RSC Payload만 프리패칭하고
  JS번들은 향후에 실제 페이지 이동이 발생했을 때에만 불러오도록 설정됨 ≒ JS 번들은 프리패칭 되지 않는다.

## 정리

- App Router 버전에서는 페이지의 데이터가 서버 컴포넌트는 RSC Payload로,
  클라이언트 컴포넌트는 JS 번들로 나뉘어 동시에 전달된다.
