# App Router · 사전 렌더링 · RSC · 프리패칭 개념 정리

## 개요

App Router에서는  
페이지 생성 방식(SSR · SSG · RSC)과  
페이지 이동 방식(클라이언트 네비게이션)이 분리되어 동작한다.

이 둘을 구분하지 못하면 다음과 같은 혼란이 생긴다.

- HTML을 안 받았으니 CSR인가?
- 서버 컴포넌트면 JS 번들이 없는 건가?
- 프리패칭을 하면 서버 컴포넌트도 JS로 보내는 건가?

이 문서는 위 혼란을 한 번에 정리하기 위한 요약이다.

---

## 최초 페이지 요청 (First Load)

브라우저가 특정 URL로 최초 접속하면 서버는 다음 과정을 거친다.

- 해당 URL에 대응되는 React 트리를 서버에서 실행한다
- 서버 컴포넌트를 실행한다
- 클라이언트 컴포넌트도 HTML 생성을 위해 한 번 평가한다
- 그 결과로 **완성된 HTML을 생성**한다

브라우저가 받는 것:

- HTML (항상)
- JS 번들 (트리 내에 클라이언트 컴포넌트가 있을 때만)

중요한 점:

- App Router + RSC 환경이라도 **최초 요청에서는 반드시 HTML을 생성한다**
- “RSC는 HTML을 안 만든다”는 말은 최초 요청 기준으로는 틀린 표현이다

---

## 서버 컴포넌트 (Server Component)

서버 컴포넌트의 특징은 다음과 같다.

- 브라우저로 JS 코드 자체가 전달되지 않는다
- 서버에서만 실행된다
- useState, useEffect, 이벤트 핸들러를 사용할 수 없다

서버 컴포넌트에서 브라우저로 전달되는 것은:

- 컴포넌트 코드 ❌
- JS 번들 ❌
- **실행 결과(RSC Payload)** ⭕

서버 컴포넌트는  
“상호작용이 없는 컴포넌트”라기보다  
**“브라우저에서 실행되지 않는 컴포넌트”**라고 이해하는 것이 정확하다.

---

## 클라이언트 컴포넌트 (Client Component)

클라이언트 컴포넌트의 특징은 다음과 같다.

- JS 번들에 포함된다
- hydration 대상이다
- 상태, 이벤트, useEffect 사용이 가능하다

실행 시점은 두 번이다.

1. 서버: HTML 생성을 위한 계산 목적의 실행
2. 브라우저: hydration 단계에서 실제 동작을 위한 실행

따라서  
“클라이언트 컴포넌트는 서버에서도 실행된다”는 말은  
**HTML 계산용 실행을 의미한다.**

---

## Link 이동 (Client Navigation)

`<Link>`를 클릭해 페이지를 이동할 경우:

- 서버는 HTML 문서를 다시 생성하지 않는다
- 서버 컴포넌트를 실행한다
- 실행 결과를 **RSC Payload 형태로 생성**한다

브라우저가 받는 것:

- HTML 문서 ❌
- RSC Payload ⭕
- JS 번들 (해당 번들이 아직 없을 경우에만)

HTML을 다시 받지 않았다고 해서 CSR이 아니다.  
이는 **서버에서 계산된 결과를 HTML이 아닌 다른 형태로 받은 것**이다.

---

## 프리패칭 (Prefetching)

프리패칭은 `<Link>`가 화면에 보이는 시점에 자동으로 발생할 수 있다.

프리패칭으로 미리 받는 것:

- 클라이언트 컴포넌트 JS 번들
- RSC Payload

프리패칭으로 받지 않는 것:

- HTML 문서
- 서버 컴포넌트 코드

프리패칭은  
“하위 트리를 미리 렌더링하는 것”이 아니라  
**다른 URL에 해당하는 페이지 트리의 리소스를 미리 준비하는 것**이다.

---

## JS 번들의 존재 기준

JS 번들의 존재 여부는  
페이지 단위가 아니라 **React 트리 전체 기준**으로 결정된다.

- 페이지에 클라이언트 컴포넌트가 없어도
- 상위 layout에 `"use client"`가 있다면
  → JS 번들은 존재한다

즉,

- “서버 컴포넌트 페이지면 JS가 없다” ❌
- “트리에 클라이언트 컴포넌트가 없으면 JS가 없다” ⭕

---

## 핵심 요약

- 최초 요청은 항상 HTML을 생성한다
- Link 이동 시에는 HTML 대신 RSC Payload를 사용한다
- 서버 컴포넌트 코드는 브라우저로 전달되지 않는다
- JS 번들은 클라이언트 컴포넌트가 있을 때만 전달된다
- 프리패칭은 HTML이 아니라 리소스를 미리 받아두는 최적화다

---

## 한 문장 정리

App Router에서는 최초 요청은 HTML로 처리되고,  
이후 페이지 이동은 RSC Payload 기반으로 처리되며,  
JS 번들은 클라이언트 컴포넌트가 존재할 때만 브라우저로 전달된다.
