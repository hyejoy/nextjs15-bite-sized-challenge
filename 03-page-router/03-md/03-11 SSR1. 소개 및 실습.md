#

## ⭐ SSR 방식 사용하기

- getServerSideProps
  - **`컴포넌트보다 먼저 실행`**되어서, 컴포넌트에 필요한 데이터 불러오게 하는 함수
  - 사전렌더링시 서버측에서 딱 한번 실행되는 코드라서 콘솔은 Next서버에 찍힘
  - 따라서 브라우저에서 동작하는 window, alert .. 등 사용하지 못함

```ts
export const getServerSideProps = () => {
  // 사전렌더링시 서버측에서 실행되는 코드라서 콘솔은 Next서버에 찍힘
  console.log("서버 콘솔 확인");
  const data = "....";
  return {
    // 반환값은 props 속성 하나만을 가진 객체를 반환해야만 함
    props: {
      data,
    },
  };
};

export default function Home({ data }: any) {
  return (
    <>
      <h1>index</h1>
    </>
  );
}
```

## ✅ SSR - 서버사이드랜더링

- 가장 기본적인 사전 렌더링 방식
- 요청이 들어올 때 마다 사전 렌더링을 진행 함
- getServerSideProps라는 약속된 이름의 함수를 만들어
  export 내보내주게되면 해당 페이지는 SSR 로 동작하도록 자동으로 설정된다.
- 페이지 컴포넌트보다 먼저 실행이 되어 해당 페이지 컴포넌트에 필요한 데이터를
  다른 백엔드 서버로부터 불러오는 등의 기능을 하게 되는 함수이다.

```jsx
// CSS Module
import SearchableLayout from "@/components/searchable-layout";
import style from "./index.module.css";
import { ReactNode, useEffect } from "react";
import books from "@/mock/books.json";
import BookItem from "@/components/book-item";

// SSR 방식으로 사전렌더링이 이루어지게됨
export const getServerSideProps = () => {
  // 컴포넌트보다 먼저 실행외더어서 컴포넌트에 필요한 데이터 불러오는 함수
  // 이런 값을 서버로부터 불러왔다고 가정했을때
  const data = "hello";

  // 서버에서 실행되기 때문에 next서버 터미널에 찍힘
  console.log("console check");
  // 서버에서 실행되기때문에 window객체 존재하지 않음
  // console.log(window)

  return {
    // return 안에는 props라는 프로퍼티로 데이터를 객체로 넣어준 다음
    // 홈 컴포넌트에 전달하도록 설정
    // ❕반드시 props 객체 프로퍼티를 포함하는 단 하나의 객체여야만 한다.
    props: {
      data,
    },
  };
};

// any 대신  InferGetServerSidePropsType<typeof getServerSideProps>
// 타입을 써주게 되면, getServerSideProps 함수의 반환값 타입이 자동으로 추론됨

export default function Home({ data }: any) {
  console.log(data);

  useEffect(() => {
    // 마운팅 된 이후에 window 출력 가능
    // 그 전에 출력하려고하면 오류남 (서버에서 실행되기때문에)
    console.log(window);
  }, []);
  return (
    <div className={style.container}>
      <section>
        <h3>지금 추천하는 도서</h3>
        {books.map((book) => (
          <BookItem key={book.id} {...book} />
        ))}
      </section>
      <section>
        <h3>등록된 모든 도서</h3>
        {books.map((book) => (
          <BookItem key={book.id} {...book} />
        ))}
      </section>
    </div>
  );
}

Home.getLayout = (page: ReactNode) => {
  return <SearchableLayout>{page}</SearchableLayout>;
};
```

## 정리

- getServerSideProps라는 함수는
  사전렌더링 과정에서 페이지 컴포넌트보다 먼저 실행이 되어서
  페이지 컴포넌트에 필요한 데이터를 가져와
  페이지 컴포넌트에게 props로 넘겨주는 역할을 하는 함수
- 주의해야 할 점은, getServerSideProps 함수는
  사전 렌더링을 하는 과정에서 딱 한번만 실행이 될거기 때문에
  오직 서버측에서만 실행이 되는 함수라는 점이다.
- 따라서 브라우저에서만 동작하는 window 객체 함수라던가, alert 등 사용할 수없음
- 따라서 요청이 들어올 때,
  해당 함수안에 있는 console.log 함수의 내용은 터미널에서 확인가능하다.
